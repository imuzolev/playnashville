<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayNashville - –†–∞–∑–º–µ—Ç–∫–∞ –∞–∫–∫–æ—Ä–¥–æ–≤</title>
    <link rel="icon" type="image/x-icon" href="/static/logo_pn.ico">
    <link rel="apple-touch-icon" href="/static/logo_pn.ico">
    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105582974', 'ym');
        ym(105582974, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105582974" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            flex: 1;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        input[type="text"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 300px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π scrollbar –¥–ª—è textarea */
        textarea::-webkit-scrollbar {
            width: 12px;
        }

        textarea::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 6px;
        }

        textarea::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }

        textarea::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd6 0%, #6a4190 100%);
        }

        /* –î–ª—è Firefox */
        textarea {
            scrollbar-width: auto;
            scrollbar-color: #667eea #e0e0e0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .buttons-row {
            display: flex;
            gap: 10px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .label-row label {
            margin-bottom: 0;
        }

        .buttons-left {
            flex: 0 0 auto;
        }

        .buttons-right {
            flex: 0 0 auto;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 14px;
            color: #555;
            position: relative;
        }

        .info-box-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.2);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #667eea;
            font-size: 16px;
            line-height: 1;
        }

        .info-box-close:hover {
            background: rgba(102, 126, 234, 0.4);
            color: #4c5ec7;
        }

        .info-box.hidden {
            display: none;
        }

        .paste-btn {
            background: #17a2b8;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
        }

        .paste-btn:hover {
            background: #138496;
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.4);
        }

        .paste-btn.pasted {
            background: #20c997;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤ */
        .hide-words-btn {
            background: #6c757d;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        .hide-words-btn:hover {
            background: #5a6268;
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .hide-words-btn.active {
            background: #fd7e14;
            box-shadow: 0 4px 15px rgba(253, 126, 20, 0.4);
        }

        .hide-words-btn.active:hover {
            background: #e96b02;
            box-shadow: 0 6px 20px rgba(253, 126, 20, 0.4);
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∏—è –∞–∫–∫–æ—Ä–¥–æ–≤ */
        .hide-chords-btn {
            background: #20c997;
            box-shadow: 0 4px 15px rgba(32, 201, 151, 0.4);
        }

        .hide-chords-btn:hover {
            background: #1aa179;
            box-shadow: 0 6px 20px rgba(32, 201, 151, 0.4);
        }

        .hide-chords-btn.active {
            background: #e83e8c;
            box-shadow: 0 4px 15px rgba(232, 62, 140, 0.4);
        }

        .hide-chords-btn.active:hover {
            background: #d61a7a;
            box-shadow: 0 6px 20px rgba(232, 62, 140, 0.4);
        }

        /* –°—Ç–∏–ª–∏ –∏–∫–æ–Ω–æ–∫ –∫–Ω–æ–ø–æ–∫ */
        .hide-words-btn,
        .hide-chords-btn,
        .copy-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            padding: 8px 10px;
        }

        .hide-words-btn svg,
        .hide-chords-btn svg,
        .copy-btn svg {
            display: block;
            vertical-align: middle;
            flex-shrink: 0;
        }

        /* –°–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ë–µ–∑ —Å–ª–æ–≤" */
        .hide-words-btn .icon-words-off { display: none; }
        .hide-words-btn.active .icon-words-on { display: none; }
        .hide-words-btn.active .icon-words-off { display: block; }

        /* –°–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ë–µ–∑ –∞–∫–∫–æ—Ä–¥–æ–≤" */
        .hide-chords-btn .icon-chords-off { display: none; }
        .hide-chords-btn.active .icon-chords-on { display: none; }
        .hide-chords-btn.active .icon-chords-off { display: block; }

        /* –°–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å" */
        .copy-btn .icon-copied { display: none; }
        .copy-btn.copied .icon-copy { display: none; }
        .copy-btn.copied .icon-copied { display: block; }

        /* –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
        .show-hints-btn {
            background: transparent;
            border: 2px solid rgba(102, 126, 234, 0.5);
            color: #667eea;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            margin-bottom: 15px;
        }

        .show-hints-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
        }

        .show-hints-btn.visible {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .result-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .result-header h2 {
            font-size: 20px;
            color: #333;
        }


        .result-text {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
            font-size: 14px;
        }

        .copy-btn {
            background: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .copy-btn:hover {
            background: #218838;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .copy-btn.copied {
            background: #20c997;
        }

        .copy-btn.copied:hover {
            background: #1aa179;
        }

        .error {
            background: #fff5f5;
            border-left: 4px solid #e53e3e;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .textarea-wrapper {
            position: relative;
        }

        .clear-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }

        .clear-btn:hover {
            background: rgba(229, 62, 62, 0.8);
        }

        .clear-btn:hover svg {
            stroke: white;
        }

        .clear-btn svg {
            width: 16px;
            height: 16px;
            stroke: #666;
            stroke-width: 2;
        }

        .textarea-wrapper:hover .clear-btn,
        .textarea-wrapper textarea:focus ~ .clear-btn {
            opacity: 1;
            visibility: visible;
        }

        .clear-btn.show {
            opacity: 1;
            visibility: visible;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ layout —Å –∏—Å—Ç–æ—Ä–∏–µ–π */
        .main-layout {
            display: flex;
            gap: 20px;
            max-width: 1300px;
            margin: 0 auto;
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ - —Ç—ë–º–Ω—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—Ç–∏–ª—å */
        .history-panel {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            height: fit-content;
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 20px;
            align-self: flex-start;
        }

        .history-header {
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            padding: 18px 20px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .history-header h2 {
            font-size: 13px;
            font-weight: 500;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-list {
            flex: 1;
            padding: 8px 0;
            overflow-y: auto;
        }

        .history-list::-webkit-scrollbar {
            width: 6px;
        }

        .history-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        .history-item {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 12px 20px;
            margin: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            position: relative;
        }

        .history-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15%;
            width: 70%;
            height: 1px;
            background: rgba(255, 255, 255, 0.04);
        }

        .history-item:last-child::after {
            display: none;
        }

        .history-item:hover {
            background: rgba(102, 126, 234, 0.15);
            border-left-color: #667eea;
        }

        .history-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-left-color: #764ba2;
        }

        .history-item-title {
            font-size: 14px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .history-item-delete {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .history-item:hover .history-item-delete {
            opacity: 1;
        }

        .history-item-delete:hover {
            background: rgba(229, 62, 62, 0.3);
            color: #fc8181;
        }

        .history-item-date {
            display: none;
        }

        .history-empty {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            padding: 40px 20px;
            font-size: 13px;
        }

        .history-empty-icon {
            font-size: 32px;
            margin-bottom: 12px;
            opacity: 0.4;
        }

        .history-refresh-btn {
            background: rgba(102, 126, 234, 0.2);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.2s ease;
        }

        .history-refresh-btn:hover {
            background: rgba(102, 126, 234, 0.35);
            color: white;
        }

        .history-clear-btn {
            background: rgba(229, 62, 62, 0.2);
            color: rgba(255, 200, 200, 0.9);
        }

        .history-clear-btn:hover {
            background: rgba(229, 62, 62, 0.4);
            color: #fc8181;
        }

        .history-footer {
            padding: 12px 16px;
            border-top: none;
        }

        .history-footer .history-refresh-btn {
            width: 100%;
            margin: 0;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 20px;
            max-height: calc(80vh - 140px);
            overflow-y: auto;
        }

        .modal-text {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 14px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .modal-btn-copy {
            background: #28a745;
            color: white;
        }

        .modal-btn-copy:hover {
            background: #218838;
        }

        .modal-btn-close {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn-close:hover {
            background: #d0d0d0;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
            }

            .history-panel {
                width: 100%;
                min-width: auto;
                max-height: none;
                order: 2;
                position: static;
            }

            .container {
                order: 1;
            }
        }

        /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .mobile-history-btn {
            display: none;
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.9);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .mobile-history-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .header {
            position: relative;
        }

        /* –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ */
        .history-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .history-overlay.show {
            display: block;
            opacity: 1;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ */
        .history-close-btn {
            display: none;
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: rgba(255, 255, 255, 0.8);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .history-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ (–¥–æ 768px –∏–ª–∏ landscape –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) */
        @media (max-width: 768px), (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 16px;
            }

            .header {
                padding: 18px 15px 18px 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .header h1 {
                font-size: 24px;
                margin-bottom: 0;
            }

            .header p {
                display: none;
            }

            .mobile-history-btn {
                top: 50%;
                transform: translateY(-50%);
            }

            /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—Ä–∏–∏ */
            .mobile-history-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* –í—ã–µ–∑–∂–∞—é—â–∞—è –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ —Å–ª–µ–≤–∞ */
            .history-panel {
                position: fixed;
                top: 0;
                left: 0;
                width: 90%;
                max-width: 320px;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0 16px 16px 0;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: 5px 0 30px rgba(0, 0, 0, 0.3);
                display: flex;
                flex-direction: column;
            }

            .history-panel.open {
                transform: translateX(0);
            }

            .history-header {
                padding: 20px;
                position: relative;
                flex-shrink: 0;
            }

            .history-close-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .history-list {
                flex: 1;
                overflow-y: auto;
                max-height: none;
            }

            .history-footer {
                flex-shrink: 0;
                position: sticky;
                bottom: 0;
                background: linear-gradient(180deg, #16213e 0%, #1a1a2e 100%);
                padding: 15px 20px;
                padding-bottom: calc(15px + env(safe-area-inset-bottom, 0px));
            }

            .history-toggle-icon {
                display: none;
            }

            .content {
                padding: 20px 15px;
            }

            .info-box {
                padding: 12px;
                font-size: 13px;
            }

            textarea {
                min-height: 200px;
                font-size: 14px;
            }

            .buttons-row {
                flex-wrap: wrap;
            }

            .btn {
                padding: 10px 14px;
                font-size: 12px;
            }

            .label-row {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
            }

            .label-row .buttons-row {
                flex: 0 0 auto;
            }

            .label-row .buttons-row .btn {
                flex: 0 0 auto;
            }

            .result-text {
                font-size: 13px;
                padding: 15px;
            }

            .history-item {
                padding: 12px 20px;
            }

            .history-item-title {
                font-size: 14px;
            }

            /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .history-item-delete {
                opacity: 1;
                padding: 8px 10px;
                font-size: 16px;
            }

            .history-footer {
                padding: 15px 20px;
            }

            .history-refresh-btn {
                padding: 12px 16px;
            }

            /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .modal-overlay {
                padding: 10px;
            }

            .modal-content {
                border-radius: 16px;
                max-height: 90vh;
            }

            .modal-header {
                padding: 15px;
            }

            .modal-header h3 {
                font-size: 16px;
            }

            .modal-body {
                padding: 15px;
            }

            .modal-text {
                font-size: 13px;
                padding: 15px;
            }

            .modal-footer {
                padding: 12px 15px;
                flex-direction: column;
            }

            .modal-btn {
                padding: 14px 20px;
            }

            .site-footer {
                padding: 8px;
                margin-top: 3px;
            }

            .site-footer a {
                font-size: 12px;
            }
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É toggle –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
        .history-toggle-icon {
            display: none;
        }

        /* Footer —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ */
        .site-footer {
            text-align: center;
            padding: 15px;
            margin-top: 10px;
        }

        .site-footer a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .site-footer a:hover {
            color: white;
        }

        /* –ú–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã (–¥–æ 480px) */
        /* –ú–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã (–¥–æ 480px –∏–ª–∏ landscape –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö) */
        @media (max-width: 480px), (max-height: 400px) and (orientation: landscape) {
            body {
                padding: 8px;
            }

            .header {
                padding: 16px 12px 16px 42px;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 0;
            }

            .mobile-history-btn {
                width: 28px;
                height: 28px;
                font-size: 18px;
                left: 10px;
            }

            .content {
                padding: 15px 12px;
            }

            .form-group label {
                font-size: 13px;
            }

            textarea {
                min-height: 180px;
                padding: 10px 12px;
            }

            .btn {
                padding: 12px 10px;
                font-size: 11px;
            }

            .clear-btn {
                width: 24px;
                height: 24px;
            }

            .clear-btn svg {
                width: 14px;
                height: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div class="history-overlay" id="historyOverlay"></div>
    
    <div class="main-layout">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div class="history-panel">
        <div class="history-header" id="historyToggle">
            <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
            <span class="history-toggle-icon">‚ñº</span>
            <button class="history-close-btn" id="historyCloseBtn" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        </div>
        <div class="history-list" id="historyList">
            <div class="history-empty">
                <div class="history-empty-icon">üìÑ</div>
                <p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>
            </div>
        </div>
        <div class="history-footer">
            <button class="history-refresh-btn history-clear-btn" id="clearHistoryBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é">üóë –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <button class="mobile-history-btn" id="mobileHistoryBtn" title="–ò—Å—Ç–æ—Ä–∏—è">‚ò∞</button>
            <h1>–ù—ç—à–≤–∏–ª–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–∫–∫–æ—Ä–¥–æ–≤</h1>
            <p>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç—É–ø–µ–Ω–µ–π –∫ –∞–∫–∫–æ—Ä–¥–∞–º –≤ –≤–∞—à–µ–º —Ç–µ–∫—Å—Ç–µ</p>
        </div>

        <div class="content">
            <button type="button" class="show-hints-btn" id="showHintsBtn">
                <span>üí°</span> –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
            </button>

            <div class="info-box" id="infoBox">
                <button type="button" class="info-box-close" id="infoBoxClose" title="–°–∫—Ä—ã—Ç—å">√ó</button>
                <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏ –≤ –ø–æ–ª–µ –Ω–∏–∂–µ. 
                –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ª–∞–¥ (–º–∞–∂–æ—Ä/–º–∏–Ω–æ—Ä) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫–∫–æ—Ä–¥–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ.
            </div>

            <div class="info-box" id="infoBox2" style="margin-top: 20px;">
                <button type="button" class="info-box-close" id="infoBoxClose2" title="–°–∫—Ä—ã—Ç—å">√ó</button>
                <strong>–ß—Ç–æ —Ç–∞–∫–æ–µ –ù—ç—à–≤–∏–ª–ª—å—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞?</strong><br><br>
                –≠—Ç–æ —Å–ø–æ—Å–æ–± –∑–∞–ø–∏—Å–∏ –∞–∫–∫–æ—Ä–¥–æ–≤ <b>—Ü–∏—Ñ—Ä–∞–º–∏</b> –≤–º–µ—Å—Ç–æ –±—É–∫–≤. –ö–∞–∂–¥—ã–π –∞–∫–∫–æ—Ä–¥ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç—Å—è –Ω–æ–º–µ—Ä–æ–º —Å—Ç—É–ø–µ–Ω–∏ –≤ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–æ—Ç 1 –¥–æ 7).<br><br>
                <b>–ü—Ä–∏–º–µ—Ä:</b> –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è <code style="background:#e0e0e0; padding:2px 6px; border-radius:4px;">C - F - G - C</code> –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ 
                <code style="background:#e0e0e0; padding:2px 6px; border-radius:4px;">1 - 4 - 5 - 1</code><br><br>
                <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:</b> –ü–µ—Å–Ω—é –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Å—ã–≥—Ä–∞—Ç—å –≤ –ª—é–±–æ–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ—Ç–µ –±–∞–∑–æ–≤—É—é –Ω–æ—Ç—É, –∞ —Ü–∏—Ñ—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ.
            </div>


            <form id="chordForm">
                <div class="form-group">
                    <div class="label-row">
                        <div class="buttons-row buttons-left">
                            <button type="button" class="btn paste-btn" id="pasteBtn">–í—Å—Ç–∞–≤–∏—Ç—å</button>
                            <button type="submit" class="btn" id="submitBtn">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
                        </div>
                        <div class="buttons-row buttons-right">
                            <button type="button" class="btn hide-words-btn" id="hideWordsBtn" title="–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–∞">
                                <!-- –ò–∫–æ–Ω–∫–∞ "—Ç–µ–∫—Å—Ç –≤–∏–¥–µ–Ω" - –±—É–∫–≤–∞ A -->
                                <svg class="icon-words-on" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 4L6 20"></path>
                                    <path d="M12 4L18 20"></path>
                                    <path d="M8 14H16"></path>
                                </svg>
                                <!-- –ò–∫–æ–Ω–∫–∞ "—Ç–µ–∫—Å—Ç —Å–∫—Ä—ã—Ç" - –±—É–∫–≤–∞ A –ø–µ—Ä–µ—á—ë—Ä–∫–Ω—É—Ç–∞—è -->
                                <svg class="icon-words-off" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 4L6 20" opacity="0.5"></path>
                                    <path d="M12 4L18 20" opacity="0.5"></path>
                                    <path d="M8 14H16" opacity="0.5"></path>
                                    <line x1="4" y1="20" x2="20" y2="4" stroke-width="2.5"></line>
                                </svg>
                            </button>
                            <button type="button" class="btn hide-chords-btn" id="hideChordsBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç—É–ø–µ–Ω–∏">
                                <!-- –ò–∫–æ–Ω–∫–∞ "–∞–∫–∫–æ—Ä–¥—ã –≤–∏–¥–Ω—ã" - –≥–∏—Ç–∞—Ä–∞ -->
                                <svg class="icon-chords-on" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 3L21 5L19 7"></path>
                                    <path d="M20 4L16 8"></path>
                                    <ellipse cx="10" cy="14" rx="6" ry="7"></ellipse>
                                    <circle cx="10" cy="14" r="2"></circle>
                                </svg>
                                <!-- –ò–∫–æ–Ω–∫–∞ "–∞–∫–∫–æ—Ä–¥—ã —Å–∫—Ä—ã—Ç—ã" - –≥–∏—Ç–∞—Ä–∞ –ø–µ—Ä–µ—á—ë—Ä–∫–Ω—É—Ç–∞—è -->
                                <svg class="icon-chords-off" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 3L21 5L19 7" opacity="0.5"></path>
                                    <path d="M20 4L16 8" opacity="0.5"></path>
                                    <ellipse cx="10" cy="14" rx="6" ry="7" opacity="0.5"></ellipse>
                                    <circle cx="10" cy="14" r="2" opacity="0.5"></circle>
                                    <line x1="4" y1="20" x2="20" y2="4" stroke-width="2.5"></line>
                                </svg>
                            </button>
                            <button type="button" class="btn copy-btn" id="copyBtn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç">
                                <!-- –ò–∫–æ–Ω–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
                                <svg class="icon-copy" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <!-- –ò–∫–æ–Ω–∫–∞ "—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ" (–≥–∞–ª–æ—á–∫–∞) -->
                                <svg class="icon-copied" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="textarea-wrapper">
                        <textarea id="text" name="text" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏ –∑–¥–µ—Å—å..." required></textarea>
                        <button type="button" class="clear-btn" id="clearBtn" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 7L18.1327 19.1425C18.0579 20.1891 17.187 21 16.1378 21H7.86224C6.81296 21 5.94208 20.1891 5.86732 19.1425L5 7M10 11V17M14 11V17M15 7V4C15 3.44772 14.5523 3 14 3H10C9.44772 3 9 3.44772 9 4V7M4 7H20" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #666;">–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
            </div>

            <div class="error" id="error"></div>
        </div>
    </div>
    </div> <!-- –ó–∞–∫—Ä—ã–≤–∞–µ–º main-layout -->

    <!-- Footer —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ -->
    <footer class="site-footer">
        <a href="https://t.me/imuzolev" target="_blank" rel="noopener noreferrer">—Ç–≥: @imuzolev</a>
    </footer>

    <script>
        const form = document.getElementById('chordForm');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const copyBtn = document.getElementById('copyBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const clearBtn = document.getElementById('clearBtn');
        const textArea = document.getElementById('text');
        const infoBox = document.getElementById('infoBox');
        const infoBox2 = document.getElementById('infoBox2');
        const infoBoxClose = document.getElementById('infoBoxClose');
        const infoBoxClose2 = document.getElementById('infoBoxClose2');
        const showHintsBtn = document.getElementById('showHintsBtn');
        const hideWordsBtn = document.getElementById('hideWordsBtn');
        const hideChordsBtn = document.getElementById('hideChordsBtn');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∏ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        let fullText = '';
        let isWordsHidden = false;
        let isChordsHidden = false;

        // –°–∫—Ä—ã—Ç–∏–µ info-box –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
        infoBoxClose.addEventListener('click', () => {
            infoBox.classList.add('hidden');
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏" –µ—Å–ª–∏ –æ–±–µ —Å–∫—Ä—ã—Ç—ã
            if (infoBox.classList.contains('hidden') && infoBox2.classList.contains('hidden')) {
                showHintsBtn.classList.add('visible');
            }
        });

        infoBoxClose2.addEventListener('click', () => {
            infoBox2.classList.add('hidden');
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏" –µ—Å–ª–∏ –æ–±–µ —Å–∫—Ä—ã—Ç—ã
            if (infoBox.classList.contains('hidden') && infoBox2.classList.contains('hidden')) {
                showHintsBtn.classList.add('visible');
            }
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–Ω–æ–≤–∞
        showHintsBtn.addEventListener('click', () => {
            infoBox.classList.remove('hidden');
            infoBox2.classList.remove('hidden');
            showHintsBtn.classList.remove('visible');
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç Key
        function toEnglishKey(tonality) {
            // tonality —Ñ–æ—Ä–º–∞—Ç: "C (major)" –∏–ª–∏ "Am (minor)"
            const match = tonality.match(/^([A-G][#b]?m?)\s*\((\w+)\)$/);
            if (match) {
                const note = match[1];
                const mode = match[2];
                // –£–±–∏—Ä–∞–µ–º 'm' –∏–∑ –Ω–æ—Ç—ã –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å (–¥–ª—è –º–∏–Ω–æ—Ä–∞)
                const cleanNote = note.replace('m', '');
                const modeEng = mode === 'major' ? 'maj' : 'min';
                return `Key: ${cleanNote} ${modeEng}`;
            }
            return `Key: ${tonality}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å—Ç—É–ø–µ–Ω–µ–π –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º (Unicode Bold)
        function makeBoldDigits(text) {
            // –ó–∞–º–µ–Ω—è–µ–º —Ü–∏—Ñ—Ä—ã –≤ —Å–∫–æ–±–∫–∞—Ö –Ω–∞ –∂–∏—Ä–Ω—ã–µ Unicode
            const boldDigits = {'0': 'ùü¨', '1': 'ùü≠', '2': 'ùüÆ', '3': 'ùüØ', '4': 'ùü∞', '5': 'ùü±', '6': 'ùü≤', '7': 'ùü≥', '8': 'ùü¥', '9': 'ùüµ'};
            
            // –ó–∞–º–µ–Ω—è–µ–º —Ü–∏—Ñ—Ä—ã –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫ –Ω–∞ –∂–∏—Ä–Ω—ã–µ
            return text.replace(/\(([^)]+)\)/g, (match, content) => {
                // –ó–∞–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ–±–æ–∫
                const boldContent = content.replace(/[0-9]/g, d => boldDigits[d] || d);
                return '(' + boldContent + ')';
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ Unicode Bold (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞ –∏ —Ü–∏—Ñ—Ä—ã)
        function toBoldUnicode(str) {
            const boldMap = {
                'A': 'ùóî', 'B': 'ùóï', 'C': 'ùóñ', 'D': 'ùóó', 'E': 'ùóò', 'F': 'ùóô', 'G': 'ùóö', 'H': 'ùóõ', 'I': 'ùóú',
                'J': 'ùóù', 'K': 'ùóû', 'L': 'ùóü', 'M': 'ùó†', 'N': 'ùó°', 'O': 'ùó¢', 'P': 'ùó£', 'Q': 'ùó§', 'R': 'ùó•',
                'S': 'ùó¶', 'T': 'ùóß', 'U': 'ùó®', 'V': 'ùó©', 'W': 'ùó™', 'X': 'ùó´', 'Y': 'ùó¨', 'Z': 'ùó≠',
                'a': 'ùóÆ', 'b': 'ùóØ', 'c': 'ùó∞', 'd': 'ùó±', 'e': 'ùó≤', 'f': 'ùó≥', 'g': 'ùó¥', 'h': 'ùóµ', 'i': 'ùó∂',
                'j': 'ùó∑', 'k': 'ùó∏', 'l': 'ùóπ', 'm': 'ùó∫', 'n': 'ùóª', 'o': 'ùóº', 'p': 'ùóΩ', 'q': 'ùóæ', 'r': 'ùóø',
                's': 'ùòÄ', 't': 'ùòÅ', 'u': 'ùòÇ', 'v': 'ùòÉ', 'w': 'ùòÑ', 'x': 'ùòÖ', 'y': 'ùòÜ', 'z': 'ùòá',
                '0': 'ùü¨', '1': 'ùü≠', '2': 'ùüÆ', '3': 'ùüØ', '4': 'ùü∞', '5': 'ùü±', '6': 'ùü≤', '7': 'ùü≥', '8': 'ùü¥', '9': 'ùüµ'
            };
            return str.split('').map(c => boldMap[c] || c).join('');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π —á–∞—Å—Ç–µ–π –ø–µ—Å–µ–Ω (–ó–ê–ì–õ–ê–í–ù–´–ú–ò + –º–∞—Ä–∫–µ—Ä ‚ñ∏ –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö, Unicode Bold –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö)
        function makeBoldSectionNames(text) {
            const lines = text.split('\n');
            const result = [];
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
            const russianPattern = /^(\s*)(–∫—É–ø–ª–µ—Ç|–ø—Ä–∏–ø–µ–≤|–±—Ä–∏–¥–∂|–ø–µ—Ä–µ—Ö–æ–¥|–≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ|–∞—É—Ç—Ä–æ|–∏–Ω—Ç—Ä–æ|–∫–æ–¥–∞|–ø—Ä–æ–∏–≥—Ä—ã—à|—Å–æ–ª–æ)(\s*\d*)(\s*:?\s*)$/i;
            const russianNumFirstPattern = /^(\s*)(\d+)(\s*)(–∫—É–ø–ª–µ—Ç|–ø—Ä–∏–ø–µ–≤|–±—Ä–∏–¥–∂)(\s*:?\s*)$/i;
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
            const englishPattern = /^(\s*)(verse|chorus|bridge|pre-?chorus|intro|outro|hook|refrain|interlude|solo)(\s*\d*)(\s*:?\s*)$/i;
            
            for (const line of lines) {
                let match;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
                if ((match = line.match(russianPattern))) {
                    const [, prefix, name, num, suffix] = match;
                    result.push(prefix + '‚ñ∏ ' + name.toUpperCase() + num.toUpperCase() + suffix);
                }
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä—É—Å—Å–∫–∏–µ —Å –Ω–æ–º–µ—Ä–æ–º –≤ –Ω–∞—á–∞–ª–µ (1 –∫—É–ø–ª–µ—Ç)
                else if ((match = line.match(russianNumFirstPattern))) {
                    const [, prefix, num, space, name, suffix] = match;
                    result.push(prefix + '‚ñ∏ ' + num + space + name.toUpperCase() + suffix);
                }
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
                else if ((match = line.match(englishPattern))) {
                    const [, prefix, name, num, suffix] = match;
                    result.push(prefix + toBoldUnicode(name + num) + suffix);
                }
                else {
                    result.push(line);
                }
            }
            
            return result.join('\n');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
        function updateClearBtnVisibility() {
            if (textArea.value.trim()) {
                clearBtn.classList.add('show');
            } else {
                clearBtn.classList.remove('show');
            }
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ
        textArea.addEventListener('input', updateClearBtnVisibility);

        // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
        clearBtn.addEventListener('click', () => {
            textArea.value = '';
            textArea.focus();
            clearBtn.classList.remove('show');
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ
            error.classList.remove('show');
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤ –∏ –∞–∫–∫–æ—Ä–¥–æ–≤
            fullText = '';
            isWordsHidden = false;
            isChordsHidden = false;
            hideWordsBtn.classList.remove('active');
            hideChordsBtn.classList.remove('active');
        });

        // –í—Å—Ç–∞–≤–∫–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
        pasteBtn.addEventListener('click', async () => {
            try {
                const clipboardText = await navigator.clipboard.readText();
                if (clipboardText) {
                    textArea.value = clipboardText;
                    textArea.focus();
                    // –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
                    textArea.setSelectionRange(0, 0);
                    textArea.scrollTop = 0;
                    updateClearBtnVisibility();
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤ –∏ –∞–∫–∫–æ—Ä–¥–æ–≤
            fullText = '';
            isWordsHidden = false;
            isChordsHidden = false;
            hideWordsBtn.classList.remove('active');
            hideChordsBtn.classList.remove('active');
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const originalText = pasteBtn.textContent;
                    pasteBtn.textContent = '‚úì –í—Å—Ç–∞–≤–ª–µ–Ω–æ!';
                    pasteBtn.classList.add('pasted');
                    
                    setTimeout(() => {
                        pasteBtn.textContent = originalText;
                        pasteBtn.classList.remove('pasted');
                    }, 2000);
                } else {
                    showError('–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø—É—Å—Ç');
                }
            } catch (err) {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é (Ctrl+V).');
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const text = document.getElementById('text').value.trim();
            // –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –ª–∞–¥ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            const key = null;
            const mode = null;

            if (!text) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.classList.add('show');
            error.classList.remove('show');
            submitBtn.disabled = true;

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text, key, mode }),
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.');
                }

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                }

                // –î–æ–±–∞–≤–ª—è–µ–º Key –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π –∏ —Ç–µ–∫—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –∂–∏—Ä–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
                const keyLine = toEnglishKey(data.tonality);
                const resultText = keyLine + '\n\n' + makeBoldSectionNames(makeBoldDigits(data.annotated_text));
                textArea.value = resultText;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤ –∏ –∞–∫–∫–æ—Ä–¥–æ–≤
                fullText = resultText;
                isWordsHidden = false;
                isChordsHidden = false;
                hideWordsBtn.classList.remove('active');
                hideChordsBtn.classList.remove('active');
                
                // –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
                textArea.setSelectionRange(0, 0);
                textArea.scrollTop = 0;
                textArea.focus();
                
                error.classList.remove('show');
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                infoBox.classList.add('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–æ–∂–µ —Å–∫—Ä—ã—Ç–∞
                if (infoBox2.classList.contains('hidden')) {
                    showHintsBtn.classList.add('visible');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
                updateClearBtnVisibility();

            } catch (err) {
                showError(err.message);
            } finally {
                loading.classList.remove('show');
                submitBtn.disabled = false;
            }
        });

        copyBtn.addEventListener('click', async () => {
            const textToCopy = textArea.value;
            if (!textToCopy) {
                showError('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }

            try {
                await navigator.clipboard.writeText(textToCopy);
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (–∏–∫–æ–Ω–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ CSS)
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                tempTextArea.style.position = 'fixed';
                tempTextArea.style.left = '-999999px';
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    copyBtn.classList.add('copied');
                    
                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                    }, 2000);
                } catch (fallbackErr) {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–¥–µ–ª–∏—Ç—å –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.');
                } finally {
                    document.body.removeChild(tempTextArea);
                }
            }
        });

        function showError(message) {
            error.textContent = message;
            error.classList.add('show');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ "–≤–∞–∂–Ω–æ–π" (–∞–∫–∫–æ—Ä–¥—ã, —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —á–∞—Å—Ç–∏ –ø–µ—Å–Ω–∏)
        function isImportantLine(line) {
            const trimmed = line.trim();
            
            // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º (–¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            if (trimmed === '') return true;
            
            // Key: —Å—Ç—Ä–æ–∫–∞ —Å —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
            if (trimmed.startsWith('Key:')) return true;
            
            // –°—Ç—Ä–æ–∫–∏ —Å –∞–∫–∫–æ—Ä–¥–∞–º–∏ (—Å–æ–¥–µ—Ä–∂–∞—Ç —Å–∫–æ–±–∫–∏ —Å —Ü–∏—Ñ—Ä–∞–º–∏)
            if (/\([^)]*[ùü¨ùü≠ùüÆùüØùü∞ùü±ùü≤ùü≥ùü¥ùüµ0-9]+[^)]*\)/.test(trimmed)) return true;
            
            // –ß–∞—Å—Ç–∏ –ø–µ—Å–µ–Ω (–Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º) - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
            const partPatterns = [
                // –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ —Å –Ω–æ–º–µ—Ä–æ–º: "–ö—É–ø–ª–µ—Ç 1:", "1 –∫—É–ø–ª–µ—Ç", "–ö—É–ø–ª–µ—Ç:", "–ü—Ä–∏–ø–µ–≤ 2" –∏ —Ç.–¥.
                /^(\d+\s*)?(–∫—É–ø–ª–µ—Ç|–ø—Ä–∏–ø–µ–≤|–±—Ä–∏–¥–∂|–ø–µ—Ä–µ—Ö–æ–¥|–≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ|–∞—É—Ç—Ä–æ|–∏–Ω—Ç—Ä–æ|–∫–æ–¥–∞|–ø—Ä–æ–∏–≥—Ä—ã—à|—Å–æ–ª–æ)(\s*\d+)?[\s:]*$/i,
                /(–∫—É–ø–ª–µ—Ç|–ø—Ä–∏–ø–µ–≤|–±—Ä–∏–¥–∂|–ø–µ—Ä–µ—Ö–æ–¥|–≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ|–∞—É—Ç—Ä–æ|–∏–Ω—Ç—Ä–æ|–∫–æ–¥–∞|–ø—Ä–æ–∏–≥—Ä—ã—à|—Å–æ–ª–æ)\s*\d*\s*:/i,
                // –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
                /^(\d+\s*)?(verse|chorus|bridge|pre-chorus|intro|outro|hook|refrain|interlude|solo)(\s*\d+)?[\s:]*$/i,
                /(verse|chorus|bridge|pre-chorus|intro|outro|hook|refrain|interlude|solo)\s*\d*\s*:/i,
                /^(v\d|c\d|b\d|pre|post)/i,  // V1, C1, B1 –∏ —Ç.–¥.
                /^\[.*\]$/,  // [–ö—É–ø–ª–µ—Ç 1], [Chorus] –∏ —Ç.–¥.
                /^#/  // # –ö—É–ø–ª–µ—Ç –∏ —Ç.–¥.
            ];
            
            for (const pattern of partPatterns) {
                if (pattern.test(trimmed)) return true;
            }
            
            return false;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã -> 2 –ø—Ä–æ–±–µ–ª–∞)
        function normalizeSpaces(line) {
            // –ó–∞–º–µ–Ω—è–µ–º 3+ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ 2 –ø—Ä–æ–±–µ–ª–∞
            return line.replace(/\s{3,}/g, '  ');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)
        function filterText(text) {
            const lines = text.split('\n');
            const filteredLines = [];
            let prevWasEmpty = false;
            
            for (const line of lines) {
                if (isImportantLine(line)) {
                    // –ò–∑–±–µ–≥–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø–æ–¥—Ä—è–¥
                    if (line.trim() === '') {
                        if (!prevWasEmpty) {
                            filteredLines.push('');
                            prevWasEmpty = true;
                        }
                    } else {
                        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ —Å—Ç—Ä–æ–∫–µ
                        filteredLines.push(normalizeSpaces(line.trim()));
                        prevWasEmpty = false;
                    }
                }
            }
            
            // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
            while (filteredLines.length > 0 && filteredLines[0].trim() === '') {
                filteredLines.shift();
            }
            while (filteredLines.length > 0 && filteredLines[filteredLines.length - 1].trim() === '') {
                filteredLines.pop();
            }
            
            return filteredLines.join('\n');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ —Å–ª–æ–≤
        hideWordsBtn.addEventListener('click', () => {
            if (!textArea.value.trim()) {
                showError('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                return;
            }
            
            if (!isWordsHidden) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω
                if (!fullText) {
                    fullText = textArea.value;
                }
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
                let filtered = filterText(fullText);
                if (filtered.trim() === '') {
                    showError('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∞–∫–∫–æ—Ä–¥–æ–≤ –∏–ª–∏ —á–∞—Å—Ç–µ–π –ø–µ—Å–Ω–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    return;
                }
                
                // –ï—Å–ª–∏ –∞–∫–∫–æ—Ä–¥—ã —Å–∫—Ä—ã—Ç—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º –∏ —ç—Ç–æ
                if (isChordsHidden) {
                    filtered = removeChordNames(filtered);
                }
                
                textArea.value = filtered;
                isWordsHidden = true;
                hideWordsBtn.classList.add('active');
            } else {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç (—Å —É—á—ë—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–∫–∫–æ—Ä–¥–æ–≤)
                if (fullText) {
                    textArea.value = isChordsHidden ? removeChordNames(fullText) : fullText;
                }
                isWordsHidden = false;
                hideWordsBtn.classList.remove('active');
            }
            
            // –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
            textArea.setSelectionRange(0, 0);
            textArea.scrollTop = 0;
            textArea.focus();
            
            updateClearBtnVisibility();
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–æ—Ä–¥–æ–≤ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç—É–ø–µ–Ω–∏)
        function removeChordNames(text) {
            // –ó–∞–º–µ–Ω—è–µ–º "–ê–∫–∫–æ—Ä–¥ (—Ü–∏—Ñ—Ä–∞)" –Ω–∞ –ø—Ä–æ—Å—Ç–æ "—Ü–∏—Ñ—Ä–∞"
            // –ü–∞—Ç—Ç–µ—Ä–Ω –∏—â–µ—Ç: –±—É–∫–≤–µ–Ω–Ω–æ–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ –∞–∫–∫–æ—Ä–¥–∞ + –ø—Ä–æ–±–µ–ª—ã + (—Ü–∏—Ñ—Ä–∞)
            // –ù–∞–ø—Ä–∏–º–µ—Ä: "Gm (ùüÆ)" -> "ùüÆ", "F/A (ùü≠)" -> "ùü≠"
            return text.replace(/[A-G][#b]?(?:m|maj|min|dim|aug|sus|add)?(?:\d+)?(?:\/[A-G][#b]?)?\s*\(([^)]+)\)/g, '$1');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –∞–∫–∫–æ—Ä–¥–æ–≤
        hideChordsBtn.addEventListener('click', () => {
            if (!textArea.value.trim()) {
                showError('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                return;
            }
            
            if (!isChordsHidden) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω
                if (!fullText) {
                    fullText = textArea.value;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Ç–µ–∫—Å—Ç (—Å —É—á—ë—Ç–æ–º "–±–µ–∑ —Å–ª–æ–≤")
                const baseText = isWordsHidden ? filterText(fullText) : fullText;
                
                // –£–¥–∞–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∞–∫–∫–æ—Ä–¥–æ–≤, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç—É–ø–µ–Ω–∏
                const withoutChords = removeChordNames(baseText);
                
                textArea.value = withoutChords;
                isChordsHidden = true;
                hideChordsBtn.classList.add('active');
            } else {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç (—Å —É—á—ë—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è "–±–µ–∑ —Å–ª–æ–≤")
                if (fullText) {
                    textArea.value = isWordsHidden ? filterText(fullText) : fullText;
                }
                isChordsHidden = false;
                hideChordsBtn.classList.remove('active');
            }
            
            // –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
            textArea.setSelectionRange(0, 0);
            textArea.scrollTop = 0;
            textArea.focus();
            
            updateClearBtnVisibility();
        });

        // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
        const historyList = document.getElementById('historyList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
        async function loadHistory() {
            try {
                const response = await fetch('/history');
                const data = await response.json();
                
                if (data.files && data.files.length > 0) {
                    historyList.innerHTML = data.files.map(file => `
                        <div class="history-item" data-filename="${file.filename}">
                            <div class="history-item-title">${file.title || file.filename}</div>
                            <button class="history-item-delete" data-filename="${file.filename}" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                        </div>
                    `).join('');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
                    document.querySelectorAll('.history-item').forEach(item => {
                        item.addEventListener('click', (e) => {
                            // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
                            if (!e.target.classList.contains('history-item-delete')) {
                                openHistoryFile(item.dataset.filename);
                            }
                        });
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                    document.querySelectorAll('.history-item-delete').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            deleteHistoryFile(btn.dataset.filename);
                        });
                    });
                } else {
                    historyList.innerHTML = `
                        <div class="history-empty">
                            <div class="history-empty-icon">üìÑ</div>
                            <p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>
                        </div>
                    `;
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', err);
                historyList.innerHTML = `
                    <div class="history-empty">
                        <div class="history-empty-icon">‚ö†Ô∏è</div>
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                    </div>
                `;
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
        async function deleteHistoryFile(filename) {
            try {
                const response = await fetch(`/history/${filename}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                    loadHistory();
                } else {
                    showError(data.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', err);
                showError('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ - –≤—Å—Ç–∞–≤–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        async function openHistoryFile(filename) {
            try {
                const response = await fetch(`/history/${filename}`);
                const data = await response.json();
                
                if (data.content) {
                    // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    textArea.value = data.content;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–≤ –∏ –∞–∫–∫–æ—Ä–¥–æ–≤
                    fullText = data.content;
                    isWordsHidden = false;
                    isChordsHidden = false;
                    hideWordsBtn.classList.remove('active');
                    hideChordsBtn.classList.remove('active');
                    
                    // –ö—É—Ä—Å–æ—Ä –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
                    textArea.setSelectionRange(0, 0);
                    textArea.scrollTop = 0;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
                    updateClearBtnVisibility();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
                    error.classList.remove('show');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                    if (isMobile()) {
                        closeHistoryPanel();
                    } else {
                        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
                        textArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        textArea.focus();
                    }
                    
                    // –û—Ç–º–µ—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                    document.querySelectorAll('.history-item').forEach(item => {
                        item.classList.toggle('active', item.dataset.filename === filename);
                    });
                } else {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', err);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
        async function clearAllHistory() {
            try {
                const response = await fetch('/history/clear', {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (data.success) {
                    loadHistory();
                } else {
                    showError(data.error || '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', err);
                showError('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        }

        clearHistoryBtn.addEventListener('click', clearAllHistory);

        // –ú–æ–±–∏–ª—å–Ω–∞—è –≤—ã–µ–∑–∂–∞—é—â–∞—è –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏
        const historyPanel = document.querySelector('.history-panel');
        const historyOverlay = document.getElementById('historyOverlay');
        const mobileHistoryBtn = document.getElementById('mobileHistoryBtn');
        const historyCloseBtn = document.getElementById('historyCloseBtn');

        function isMobile() {
            // –£—á–∏—Ç—ã–≤–∞–µ–º –∏ portrait, –∏ landscape —Ä–µ–∂–∏–º—ã
            return window.innerWidth <= 768 || (window.innerHeight <= 500 && window.innerWidth > window.innerHeight);
        }

        // –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏
        function openHistoryPanel() {
            historyPanel.classList.add('open');
            historyOverlay.classList.add('show');
            document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        }

        // –ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏
        function closeHistoryPanel() {
            historyPanel.classList.remove('open');
            historyOverlay.classList.remove('show');
            document.body.style.overflow = ''; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        mobileHistoryBtn.addEventListener('click', openHistoryPanel);
        historyCloseBtn.addEventListener('click', closeHistoryPanel);
        historyOverlay.addEventListener('click', closeHistoryPanel);

        // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –∏–ª–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ —ç–∫—Ä–∞–Ω–∞
        function handleResize() {
            if (!isMobile()) {
                closeHistoryPanel();
            }
        }
        
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            loadHistory();
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        const originalSubmitHandler = form.onsubmit;
        form.addEventListener('submit', () => {
            // –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
            setTimeout(loadHistory, 1000);
        });
    </script>
</body>
</html>

